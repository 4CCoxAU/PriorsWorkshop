<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Multi-level model | Workshop on Bayesian Inference: Priors and workflow</title>
  <meta name="description" content="This site provides the materials for a workshop on Bayesian data analysis, with a focus on a rigorous workflow and the definition of priors." />
  <meta name="generator" content="bookdown 0.24.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Multi-level model | Workshop on Bayesian Inference: Priors and workflow" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This site provides the materials for a workshop on Bayesian data analysis, with a focus on a rigorous workflow and the definition of priors." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Multi-level model | Workshop on Bayesian Inference: Priors and workflow" />
  
  <meta name="twitter:description" content="This site provides the materials for a workshop on Bayesian data analysis, with a focus on a rigorous workflow and the definition of priors." />
  

<meta name="author" content="Riccardo Fusaroli &amp; Chris Cox" />


<meta name="date" content="2022-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="simple-linear-regression.html"/>
<link rel="next" href="informed-priors.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Workshop on Bayesian Priors</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#structure-of-this-workshop"><i class="fa fa-check"></i><b>1.1</b> Structure of this Workshop</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#preparation"><i class="fa fa-check"></i><b>1.2</b> Preparation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#introductory-video"><i class="fa fa-check"></i><b>1.3</b> Introductory Video</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#video-on-bayesian-inference"><i class="fa fa-check"></i><b>1.4</b> Video on Bayesian inference</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html"><i class="fa fa-check"></i><b>2</b> Modeling your outcome: Intercepts-only Model</a>
<ul>
<li class="chapter" data-level="2.1" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#video-on-intercepts-only-model"><i class="fa fa-check"></i><b>2.1</b> Video on Intercepts-Only Model</a></li>
<li class="chapter" data-level="2.2" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#hands-on-exercises"><i class="fa fa-check"></i><b>2.2</b> Hands-on Exercises</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#introduction-to-the-data"><i class="fa fa-check"></i><b>2.2.1</b> Introduction to the data</a></li>
<li class="chapter" data-level="2.2.2" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#weakly-informative-priors"><i class="fa fa-check"></i><b>2.2.2</b> Weakly Informative Priors</a></li>
<li class="chapter" data-level="2.2.3" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#more-informative-priors"><i class="fa fa-check"></i><b>2.2.3</b> More Informative Priors</a></li>
<li class="chapter" data-level="2.2.4" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#intercepts-only-model"><i class="fa fa-check"></i><b>2.2.4</b> Intercepts-Only Model</a></li>
<li class="chapter" data-level="2.2.5" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#prior-posterior-update-plots"><i class="fa fa-check"></i><b>2.2.5</b> Prior-Posterior Update Plots</a></li>
<li class="chapter" data-level="2.2.6" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#interpreting-model-output"><i class="fa fa-check"></i><b>2.2.6</b> Interpreting Model Output</a></li>
<li class="chapter" data-level="2.2.7" data-path="modeling-your-outcome-intercepts-only-model.html"><a href="modeling-your-outcome-intercepts-only-model.html#bonus-question"><i class="fa fa-check"></i><b>2.2.7</b> Bonus Question</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#video-on-simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Video on Simple Linear Regression:</a></li>
<li class="chapter" data-level="3.2" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#hands-on-exercises-1"><i class="fa fa-check"></i><b>3.2</b> Hands-on Exercises</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#prior-predictive-checks"><i class="fa fa-check"></i><b>3.2.1</b> Prior Predictive Checks</a></li>
<li class="chapter" data-level="3.2.2" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#simple-regression-model"><i class="fa fa-check"></i><b>3.2.2</b> Simple Regression Model</a></li>
<li class="chapter" data-level="3.2.3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#prior-posterior-update-plots-1"><i class="fa fa-check"></i><b>3.2.3</b> Prior-Posterior Update Plots</a></li>
<li class="chapter" data-level="3.2.4" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#evidence-ratio"><i class="fa fa-check"></i><b>3.2.4</b> Evidence Ratio</a></li>
<li class="chapter" data-level="3.2.5" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#prior-sensitivity-check"><i class="fa fa-check"></i><b>3.2.5</b> Prior Sensitivity Check</a></li>
<li class="chapter" data-level="3.2.6" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#bonus-content-on-heteroskedasticity"><i class="fa fa-check"></i><b>3.2.6</b> Bonus Content on Heteroskedasticity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multi-level-model.html"><a href="multi-level-model.html"><i class="fa fa-check"></i><b>4</b> Multi-level model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multi-level-model.html"><a href="multi-level-model.html#videos-on-multi-level-model"><i class="fa fa-check"></i><b>4.1</b> Videos on Multi-level model:</a></li>
<li class="chapter" data-level="4.2" data-path="multi-level-model.html"><a href="multi-level-model.html#hands-on-exercises-2"><i class="fa fa-check"></i><b>4.2</b> Hands-on Exercises</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="multi-level-model.html"><a href="multi-level-model.html#prior-specification"><i class="fa fa-check"></i><b>4.2.1</b> Prior Specification</a></li>
<li class="chapter" data-level="4.2.2" data-path="multi-level-model.html"><a href="multi-level-model.html#multi-level-model-1"><i class="fa fa-check"></i><b>4.2.2</b> Multi-Level Model</a></li>
<li class="chapter" data-level="4.2.3" data-path="multi-level-model.html"><a href="multi-level-model.html#prior-posterior-update-plots-2"><i class="fa fa-check"></i><b>4.2.3</b> Prior-Posterior Update Plots</a></li>
<li class="chapter" data-level="4.2.4" data-path="multi-level-model.html"><a href="multi-level-model.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.2.4</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="4.2.5" data-path="multi-level-model.html"><a href="multi-level-model.html#prior-sensitivity-check-1"><i class="fa fa-check"></i><b>4.2.5</b> Prior Sensitivity Check</a></li>
<li class="chapter" data-level="4.2.6" data-path="multi-level-model.html"><a href="multi-level-model.html#partial-pooling"><i class="fa fa-check"></i><b>4.2.6</b> Partial Pooling</a></li>
<li class="chapter" data-level="4.2.7" data-path="multi-level-model.html"><a href="multi-level-model.html#student-t-model"><i class="fa fa-check"></i><b>4.2.7</b> Student t model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="informed-priors.html"><a href="informed-priors.html"><i class="fa fa-check"></i><b>5</b> Informed priors</a>
<ul>
<li class="chapter" data-level="5.1" data-path="informed-priors.html"><a href="informed-priors.html#video-on-informed-priors"><i class="fa fa-check"></i><b>5.1</b> Video on Informed priors:</a></li>
<li class="chapter" data-level="5.2" data-path="informed-priors.html"><a href="informed-priors.html#hands-on-exercises-3"><i class="fa fa-check"></i><b>5.2</b> Hands-on Exercises</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="informed-priors.html"><a href="informed-priors.html#how-to-encode-information-in-priors"><i class="fa fa-check"></i><b>5.2.1</b> How to Encode Information in Priors</a></li>
<li class="chapter" data-level="5.2.2" data-path="informed-priors.html"><a href="informed-priors.html#prior-posterior-updates-plot"><i class="fa fa-check"></i><b>5.2.2</b> Prior-Posterior Updates Plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="recommendations.html"><a href="recommendations.html"><i class="fa fa-check"></i><b>6</b> Recommendations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="recommendations.html"><a href="recommendations.html#where-to-go-for-further-study"><i class="fa fa-check"></i><b>6.1</b> Where to go for further study</a></li>
<li class="chapter" data-level="6.2" data-path="recommendations.html"><a href="recommendations.html#feedback-on-the-course"><i class="fa fa-check"></i><b>6.2</b> Feedback on the course</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://4ccoxau.github.io/PriorsWorkshop/" target="blank"> </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop on Bayesian Inference: Priors and workflow</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multi-level-model" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Multi-level model</h1>
<div id="videos-on-multi-level-model" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Videos on Multi-level model:</h2>
<p><a href="https://youtu.be/yUs4LB_9KWw" class="uri">https://youtu.be/yUs4LB_9KWw</a></p>
<p><a href="https://youtu.be/A1osWXChYr8" class="uri">https://youtu.be/A1osWXChYr8</a></p>
<p>After watching the videos we recommend you download the Markdown file and go through it in Rstudio:</p>
<ul>
<li><a href="https://github.com/4CCoxAU/PriorsWorkshop/blob/08ea1968db8114690b04e839502ea5909300a62f/03-part2.Rmd" class="uri">https://github.com/4CCoxAU/PriorsWorkshop/blob/08ea1968db8114690b04e839502ea5909300a62f/03-part2.Rmd</a></li>
</ul>
<p>Here the data (same data as the previous markdown)</p>
<ul>
<li><a href="https://github.com/4CCoxAU/PriorsWorkshop/blob/08ea1968db8114690b04e839502ea5909300a62f/vowel_space_area_data.csv" class="uri">https://github.com/4CCoxAU/PriorsWorkshop/blob/08ea1968db8114690b04e839502ea5909300a62f/vowel_space_area_data.csv</a></li>
</ul>
<p>The content of the markdown is reproduced below.</p>
</div>
<div id="hands-on-exercises-2" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Hands-on Exercises</h2>
<div id="prior-specification" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Prior Specification</h3>
<p>Let’s take our analysis to the next level (pun intended) by making a multi-level model with varying intercepts and varying slopes. In this model, we assign unique intercepts and slopes for each subject and assign them a common prior distribution. Let’s check which priors we need to specify for this model:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="multi-level-model.html#cb47-1" aria-hidden="true" tabindex="-1"></a>Articulation_f3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(ArticulationS <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Register <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>Register<span class="sc">|</span>Subject))</span>
<span id="cb47-2"><a href="multi-level-model.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(Articulation_f3,</span>
<span id="cb47-3"><a href="multi-level-model.html#cb47-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> d, </span>
<span id="cb47-4"><a href="multi-level-model.html#cb47-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> gaussian)</span></code></pre></div>
<pre><code>##                    prior     class        coef   group resp dpar nlpar bound
##                   (flat)         b                                          
##                   (flat)         b RegisterIDS                              
##                   lkj(1)       cor                                          
##                   lkj(1)       cor             Subject                      
##  student_t(3, -0.4, 2.5) Intercept                                          
##     student_t(3, 0, 2.5)        sd                                          
##     student_t(3, 0, 2.5)        sd             Subject                      
##     student_t(3, 0, 2.5)        sd   Intercept Subject                      
##     student_t(3, 0, 2.5)        sd RegisterIDS Subject                      
##     student_t(3, 0, 2.5)     sigma                                          
##        source
##       default
##  (vectorized)
##       default
##  (vectorized)
##       default
##       default
##  (vectorized)
##  (vectorized)
##  (vectorized)
##       default</code></pre>
<p>The output of the above function tells us that we now have three sources of variation in the model:</p>
<ul>
<li><ol style="list-style-type: lower-roman">
<li>the usual standard deviation of the residuals (i.e., ‘sigma’),</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-roman">
<li>the standard deviation of the population of by-subject varying intercepts (i.e., ‘Intercept’), and</li>
</ol></li>
<li><ol start="3" style="list-style-type: lower-roman">
<li>the standard deviation of the population of by-subject varying slopes (i.e., ‘RegisterIDS’).</li>
</ol></li>
</ul>
<p>The latter two sources of variation provide one of the most essential features of multi-level models: partial pooling, as we discussed in the lecture.</p>
<p>We are also told that we need to specify a prior for the correlation between the varying intercepts and the varying slopes (i.e. class = ‘cor’). This correlation captures the fact that we cannot assume the intercept and slope to be entirely independent. For example, caregivers who naturally produce a small vowel space in ADS can expand their vowel space when using IDS to a greater extent and may therefore show stronger effects.</p>
<p>We model the correlation between varying intercepts and slopes by using a so-called LKJ prior. The basic idea of the LKJ prior is that as its parameter increases, the prior favors less extreme correlations - that is, if we specify the LKJ parameter as 1, the prior represents a uniform, uninformative distribution (similar to that of a beta(1,1) distribution). If we set the parameter to 2, on the other hand, the prior serves to dampen the likelihood of extreme correlations, and we represent our lack of knowledge about the extent of correlation between the parameters. We’ll see what our prior(lkj(2), class = cor) looks like in the prior-posterior update plot below.</p>
<p>As usual, let’s start by performing a prior predictive check:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="multi-level-model.html#cb49-1" aria-hidden="true" tabindex="-1"></a>Articulation_p3 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb49-2"><a href="multi-level-model.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb49-3"><a href="multi-level-model.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> Subject),</span>
<span id="cb49-4"><a href="multi-level-model.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b),</span>
<span id="cb49-5"><a href="multi-level-model.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> RegisterIDS, <span class="at">group =</span> Subject),</span>
<span id="cb49-6"><a href="multi-level-model.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sigma),</span>
<span id="cb49-7"><a href="multi-level-model.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor))</span>
<span id="cb49-8"><a href="multi-level-model.html#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="multi-level-model.html#cb49-9" aria-hidden="true" tabindex="-1"></a>Articulation_m3_prior <span class="ot">&lt;-</span> </span>
<span id="cb49-10"><a href="multi-level-model.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb49-11"><a href="multi-level-model.html#cb49-11" aria-hidden="true" tabindex="-1"></a>    Articulation_f3,</span>
<span id="cb49-12"><a href="multi-level-model.html#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb49-13"><a href="multi-level-model.html#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-14"><a href="multi-level-model.html#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb49-15"><a href="multi-level-model.html#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> Articulation_p3,</span>
<span id="cb49-16"><a href="multi-level-model.html#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;Articulation_m3_prior&quot;</span>,</span>
<span id="cb49-17"><a href="multi-level-model.html#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#refit = &quot;on_change&quot;,</span></span>
<span id="cb49-18"><a href="multi-level-model.html#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_prior =</span> <span class="st">&quot;only&quot;</span>,</span>
<span id="cb49-19"><a href="multi-level-model.html#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">5000</span>, </span>
<span id="cb49-20"><a href="multi-level-model.html#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb49-21"><a href="multi-level-model.html#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb49-22"><a href="multi-level-model.html#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb49-23"><a href="multi-level-model.html#cb49-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb49-24"><a href="multi-level-model.html#cb49-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">2</span>),</span>
<span id="cb49-25"><a href="multi-level-model.html#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb49-26"><a href="multi-level-model.html#cb49-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.999</span>,</span>
<span id="cb49-27"><a href="multi-level-model.html#cb49-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>))</span>
<span id="cb49-28"><a href="multi-level-model.html#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(Articulation_m3_prior, <span class="at">ndraws=</span><span class="dv">100</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>After running the pp_check() function a couple of times, we should be convinced that our priors are within the order of magnitude that we expect. Great, let’s run the model on the actual data then:</p>
</div>
<div id="multi-level-model-1" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Multi-Level Model</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="multi-level-model.html#cb50-1" aria-hidden="true" tabindex="-1"></a>Articulation_m3 <span class="ot">&lt;-</span> </span>
<span id="cb50-2"><a href="multi-level-model.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb50-3"><a href="multi-level-model.html#cb50-3" aria-hidden="true" tabindex="-1"></a>    Articulation_f3,</span>
<span id="cb50-4"><a href="multi-level-model.html#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb50-5"><a href="multi-level-model.html#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-6"><a href="multi-level-model.html#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb50-7"><a href="multi-level-model.html#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> Articulation_p3,</span>
<span id="cb50-8"><a href="multi-level-model.html#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;Articulation_m3&quot;</span>,</span>
<span id="cb50-9"><a href="multi-level-model.html#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#refit = &quot;on_change&quot;,</span></span>
<span id="cb50-10"><a href="multi-level-model.html#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_prior =</span> T,</span>
<span id="cb50-11"><a href="multi-level-model.html#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">5000</span>, </span>
<span id="cb50-12"><a href="multi-level-model.html#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb50-13"><a href="multi-level-model.html#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb50-14"><a href="multi-level-model.html#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb50-15"><a href="multi-level-model.html#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb50-16"><a href="multi-level-model.html#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">2</span>),</span>
<span id="cb50-17"><a href="multi-level-model.html#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb50-18"><a href="multi-level-model.html#cb50-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.999</span>,</span>
<span id="cb50-19"><a href="multi-level-model.html#cb50-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>))</span></code></pre></div>
<p>As usual, let’s perform some posterior predictive checks to make sure that the model captures the data:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="multi-level-model.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(Articulation_m3, <span class="at">ndraws=</span><span class="dv">100</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Everything looks great, so let’s plot the conditional effects and compare the output of the multi-level model with that of the previous constant-effect model:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="multi-level-model.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(Articulation_m3), <span class="at">points =</span> T)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="multi-level-model.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of the multi-level model:</span></span>
<span id="cb53-2"><a href="multi-level-model.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Articulation_m3)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: ArticulationS ~ 1 + Register + (1 + Register | Subject) 
##    Data: d (Number of observations: 48) 
##   Draws: 2 chains, each with iter = 5000; warmup = 1000; thin = 1;
##          total post-warmup draws = 8000
## 
## Group-Level Effects: 
## ~Subject (Number of levels: 24) 
##                            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
## sd(Intercept)                  0.42      0.23     0.02     0.90 1.00     1095
## sd(RegisterIDS)                0.45      0.30     0.02     1.10 1.00     1389
## cor(Intercept,RegisterIDS)    -0.04      0.43    -0.79     0.77 1.00     5432
##                            Tail_ESS
## sd(Intercept)                  2231
## sd(RegisterIDS)                1798
## cor(Intercept,RegisterIDS)     5545
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept      -0.13      0.18    -0.49     0.23 1.00     6702     5507
## RegisterIDS    -0.39      0.21    -0.78     0.03 1.00    10609     6152
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.83      0.15     0.53     1.12 1.00     1035      895
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="multi-level-model.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of the constant-effect model:</span></span>
<span id="cb55-2"><a href="multi-level-model.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Articulation_m2)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: ArticulationS ~ 1 + Register 
##    Data: d (Number of observations: 48) 
##   Draws: 2 chains, each with iter = 5000; warmup = 1000; thin = 1;
##          total post-warmup draws = 8000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept      -0.15      0.18    -0.51     0.20 1.00     4946     4486
## RegisterIDS    -0.37      0.21    -0.77     0.04 1.00     5685     4786
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.98      0.10     0.80     1.21 1.00     5634     4848
## 
## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Q5: How does the estimate for sigma (i.e. the residual variation) in this multi-level model differ from the simple regression model? What does this indicate?</p>
<p>Answer:</p>
<hr />
</div>
<div id="prior-posterior-update-plots-2" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Prior-Posterior Update Plots</h3>
<p>Let’s create some prior-posterior update plots so we can visualise how our model updates after seeing the data:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="multi-level-model.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sample the parameters of interest:</span></span>
<span id="cb57-2"><a href="multi-level-model.html#cb57-2" aria-hidden="true" tabindex="-1"></a>Posterior_m3 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(Articulation_m3)</span>
<span id="cb57-3"><a href="multi-level-model.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="multi-level-model.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for the intercept:</span></span>
<span id="cb57-5"><a href="multi-level-model.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_m3) <span class="sc">+</span></span>
<span id="cb57-6"><a href="multi-level-model.html#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_Intercept), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="multi-level-model.html#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(b_Intercept), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb57-8"><a href="multi-level-model.html#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Intercept&#39;</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="multi-level-model.html#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="multi-level-model.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for b:</span></span>
<span id="cb58-2"><a href="multi-level-model.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_m3) <span class="sc">+</span></span>
<span id="cb58-3"><a href="multi-level-model.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_b), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="multi-level-model.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(b_RegisterIDS), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb58-5"><a href="multi-level-model.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;b&#39;</span>) <span class="sc">+</span></span>
<span id="cb58-6"><a href="multi-level-model.html#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-2.png" width="672" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="multi-level-model.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for sd of intercepts and slopes:</span></span>
<span id="cb59-2"><a href="multi-level-model.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_m3) <span class="sc">+</span></span>
<span id="cb59-3"><a href="multi-level-model.html#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(sd_Subject__Intercept), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb59-4"><a href="multi-level-model.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(sd_Subject__RegisterIDS), <span class="at">fill=</span><span class="st">&quot;#228B22&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb59-5"><a href="multi-level-model.html#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_sd_Subject__RegisterIDS), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb59-6"><a href="multi-level-model.html#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;sd&#39;</span>) <span class="sc">+</span></span>
<span id="cb59-7"><a href="multi-level-model.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-3.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="multi-level-model.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for sigma:</span></span>
<span id="cb60-2"><a href="multi-level-model.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_m3) <span class="sc">+</span></span>
<span id="cb60-3"><a href="multi-level-model.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_sigma), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="multi-level-model.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(sigma), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb60-5"><a href="multi-level-model.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;sigma&#39;</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="multi-level-model.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-4.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="multi-level-model.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for the correlation between varying intercepts and slopes:</span></span>
<span id="cb61-2"><a href="multi-level-model.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_m3) <span class="sc">+</span></span>
<span id="cb61-3"><a href="multi-level-model.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_cor_Subject), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb61-4"><a href="multi-level-model.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(cor_Subject__Intercept__RegisterIDS), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb61-5"><a href="multi-level-model.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;cor&#39;</span>) <span class="sc">+</span></span>
<span id="cb61-6"><a href="multi-level-model.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-5.png" width="672" /></p>
</div>
<div id="hypothesis-testing" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Hypothesis Testing</h3>
<p>Let’s test our hypothesis with this model by using the hypothesis() function:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="multi-level-model.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#overall</span></span>
<span id="cb62-2"><a href="multi-level-model.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(Articulation_m3, <span class="st">&quot;RegisterIDS &lt; 0&quot;</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class b:
##          Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob
## 1 (RegisterIDS) &lt; 0    -0.39      0.21    -0.72    -0.05      27.99      0.97
##   Star
## 1    *
## ---
## &#39;CI&#39;: 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 95%;
## for two-sided hypotheses, the value tested against lies outside the 95%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="multi-level-model.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for individual subjectss:</span></span>
<span id="cb64-2"><a href="multi-level-model.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(Articulation_m3, <span class="st">&quot;RegisterIDS &lt; 0&quot;</span>, <span class="at">group =</span> <span class="st">&quot;Subject&quot;</span>, <span class="at">scope=</span><span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class :
##    Group        Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
## 1     AF (RegisterIDS) &lt; 0     0.09      0.63    -0.72     1.31       1.12
## 2     AN (RegisterIDS) &lt; 0    -0.67      0.53    -1.65     0.06      14.33
## 3     CL (RegisterIDS) &lt; 0    -0.32      0.46    -1.01     0.49       3.94
## 4     DM (RegisterIDS) &lt; 0    -0.36      0.45    -1.09     0.41       4.67
## 5     IA (RegisterIDS) &lt; 0    -0.42      0.46    -1.20     0.32       5.73
## 6     JA (RegisterIDS) &lt; 0    -0.86      0.66    -2.18    -0.07      28.63
## 7     JE (RegisterIDS) &lt; 0    -0.43      0.45    -1.19     0.31       6.24
## 8     KA (RegisterIDS) &lt; 0    -0.51      0.47    -1.36     0.20       8.40
## 9     KV (RegisterIDS) &lt; 0    -0.54      0.47    -1.36     0.18       9.70
## 10    LK (RegisterIDS) &lt; 0    -0.64      0.52    -1.65     0.06      14.01
## 11    LM (RegisterIDS) &lt; 0    -0.29      0.46    -0.98     0.51       3.45
## 12    LV (RegisterIDS) &lt; 0    -0.29      0.47    -0.98     0.55       3.53
## 13    MA (RegisterIDS) &lt; 0    -0.37      0.49    -1.19     0.42       4.31
## 14    ME (RegisterIDS) &lt; 0    -0.52      0.46    -1.35     0.17       9.23
## 15   MPS (RegisterIDS) &lt; 0    -0.48      0.45    -1.29     0.23       7.40
## 16    MS (RegisterIDS) &lt; 0    -0.47      0.45    -1.25     0.24       7.26
## 17    MV (RegisterIDS) &lt; 0    -0.16      0.50    -0.82     0.80       2.29
## 18    PV (RegisterIDS) &lt; 0    -0.29      0.49    -1.05     0.56       3.26
## 19    RV (RegisterIDS) &lt; 0    -0.25      0.47    -0.94     0.61       3.10
## 20    SA (RegisterIDS) &lt; 0    -0.70      0.53    -1.74     0.01      17.74
## 21   SAF (RegisterIDS) &lt; 0    -0.40      0.45    -1.14     0.34       5.32
## 22    SC (RegisterIDS) &lt; 0    -0.35      0.44    -1.05     0.37       4.45
## 23    TL (RegisterIDS) &lt; 0    -0.76      0.59    -1.91    -0.01      20.16
## 24    TM (RegisterIDS) &lt; 0    -0.56      0.48    -1.46     0.14      10.76
##    Post.Prob Star
## 1       0.53     
## 2       0.93     
## 3       0.80     
## 4       0.82     
## 5       0.85     
## 6       0.97    *
## 7       0.86     
## 8       0.89     
## 9       0.91     
## 10      0.93     
## 11      0.78     
## 12      0.78     
## 13      0.81     
## 14      0.90     
## 15      0.88     
## 16      0.88     
## 17      0.70     
## 18      0.77     
## 19      0.76     
## 20      0.95     
## 21      0.84     
## 22      0.82     
## 23      0.95    *
## 24      0.92     
## ---
## &#39;CI&#39;: 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 95%;
## for two-sided hypotheses, the value tested against lies outside the 95%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
<div id="prior-sensitivity-check-1" class="section level3" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Prior Sensitivity Check</h3>
<p>These results look interesting - however, we may be worried about the influence of our priors. Let’s conduct a prior robustness check for this multi-level model to calm our worries:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="multi-level-model.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#code to loop through sd of intercept prior:</span></span>
<span id="cb66-2"><a href="multi-level-model.html#cb66-2" aria-hidden="true" tabindex="-1"></a>priSD <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">15</span>)</span>
<span id="cb66-3"><a href="multi-level-model.html#cb66-3" aria-hidden="true" tabindex="-1"></a>priorsN <span class="ot">&lt;-</span> Articulation_p3</span>
<span id="cb66-4"><a href="multi-level-model.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create empty sets to store output of the loop:</span></span>
<span id="cb66-5"><a href="multi-level-model.html#cb66-5" aria-hidden="true" tabindex="-1"></a>post_pred <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb66-6"><a href="multi-level-model.html#cb66-6" aria-hidden="true" tabindex="-1"></a>post_pred_lci <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb66-7"><a href="multi-level-model.html#cb66-7" aria-hidden="true" tabindex="-1"></a>post_pred_uci <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb66-8"><a href="multi-level-model.html#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(priSD)) {</span>
<span id="cb66-9"><a href="multi-level-model.html#cb66-9" aria-hidden="true" tabindex="-1"></a>  priorsN[<span class="dv">3</span>,] <span class="ot">&lt;-</span> <span class="fu">set_prior</span>(<span class="fu">paste0</span>(<span class="st">&quot;normal(0, &quot;</span>, priSD[i],<span class="st">&quot;)&quot;</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb66-10"><a href="multi-level-model.html#cb66-10" aria-hidden="true" tabindex="-1"></a>  model_for_loop <span class="ot">&lt;-</span> <span class="fu">brm</span>(Articulation_f3,</span>
<span id="cb66-11"><a href="multi-level-model.html#cb66-11" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">data   =</span> d, </span>
<span id="cb66-12"><a href="multi-level-model.html#cb66-12" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">family =</span> gaussian, </span>
<span id="cb66-13"><a href="multi-level-model.html#cb66-13" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">prior  =</span> priorsN, </span>
<span id="cb66-14"><a href="multi-level-model.html#cb66-14" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">sample_prior =</span> T,</span>
<span id="cb66-15"><a href="multi-level-model.html#cb66-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb66-16"><a href="multi-level-model.html#cb66-16" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">iter   =</span> <span class="dv">5000</span>, </span>
<span id="cb66-17"><a href="multi-level-model.html#cb66-17" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">cores  =</span> <span class="dv">2</span>,</span>
<span id="cb66-18"><a href="multi-level-model.html#cb66-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb66-19"><a href="multi-level-model.html#cb66-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb66-20"><a href="multi-level-model.html#cb66-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">2</span>),</span>
<span id="cb66-21"><a href="multi-level-model.html#cb66-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb66-22"><a href="multi-level-model.html#cb66-22" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta   =</span> <span class="fl">0.99</span>, </span>
<span id="cb66-23"><a href="multi-level-model.html#cb66-23" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">max_treedepth =</span> <span class="dv">15</span>))</span>
<span id="cb66-24"><a href="multi-level-model.html#cb66-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-25"><a href="multi-level-model.html#cb66-25" aria-hidden="true" tabindex="-1"></a>  post_preds <span class="ot">&lt;-</span> <span class="fu">spread_draws</span>(model_for_loop, b_RegisterIDS)</span>
<span id="cb66-26"><a href="multi-level-model.html#cb66-26" aria-hidden="true" tabindex="-1"></a>  post_pred[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(post_preds<span class="sc">$</span>b_RegisterIDS)</span>
<span id="cb66-27"><a href="multi-level-model.html#cb66-27" aria-hidden="true" tabindex="-1"></a>  post_pred_lci[i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(post_preds<span class="sc">$</span>b_RegisterIDS, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb66-28"><a href="multi-level-model.html#cb66-28" aria-hidden="true" tabindex="-1"></a>  post_pred_uci[i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(post_preds<span class="sc">$</span>b_RegisterIDS, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb66-29"><a href="multi-level-model.html#cb66-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-30"><a href="multi-level-model.html#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="multi-level-model.html#cb66-31" aria-hidden="true" tabindex="-1"></a>models_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(priSD, post_pred, post_pred_lci, post_pred_uci)</span>
<span id="cb66-32"><a href="multi-level-model.html#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="multi-level-model.html#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>models_data, <span class="fu">aes</span>(<span class="at">x=</span>priSD, <span class="at">y=</span>post_pred)) <span class="sc">+</span></span>
<span id="cb66-34"><a href="multi-level-model.html#cb66-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb66-35"><a href="multi-level-model.html#cb66-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">ymin =</span> post_pred_lci, <span class="at">ymax =</span> post_pred_uci) <span class="sc">+</span></span>
<span id="cb66-36"><a href="multi-level-model.html#cb66-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">1.3</span>, <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb66-37"><a href="multi-level-model.html#cb66-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Standard Deviation of Slope Prior&quot;</span>, </span>
<span id="cb66-38"><a href="multi-level-model.html#cb66-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Posterior Estimate for slope&quot;</span>, </span>
<span id="cb66-39"><a href="multi-level-model.html#cb66-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Sensitivity analysis for multi-level model&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-40"><a href="multi-level-model.html#cb66-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-41"><a href="multi-level-model.html#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb66-42"><a href="multi-level-model.html#cb66-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb66-43"><a href="multi-level-model.html#cb66-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb66-44"><a href="multi-level-model.html#cb66-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb66-45"><a href="multi-level-model.html#cb66-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Q6: How does this prior robustness check compare to that of the simple linear regression model?</p>
<p>Answer:</p>
<hr />
</div>
<div id="partial-pooling" class="section level3" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Partial Pooling</h3>
<p>The following code shows how to extract relevant data from the models and how to plot partial pooling:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="multi-level-model.html#cb67-1" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb67-2"><a href="multi-level-model.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Subject =</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;Intercept&quot;</span>]),</span>
<span id="cb67-3"><a href="multi-level-model.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ADS =</span> <span class="fu">coef</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;Intercept&quot;</span>][,<span class="dv">1</span>],</span>
<span id="cb67-4"><a href="multi-level-model.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">IDS =</span> ADS <span class="sc">+</span> <span class="fu">coef</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;RegisterIDS&quot;</span>][,<span class="dv">1</span>],</span>
<span id="cb67-5"><a href="multi-level-model.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="st">&quot;partial pooling&quot;</span></span>
<span id="cb67-6"><a href="multi-level-model.html#cb67-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(ADS<span class="sc">:</span>IDS) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb67-7"><a href="multi-level-model.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Register =</span> name,</span>
<span id="cb67-8"><a href="multi-level-model.html#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ArticulationS =</span> value</span>
<span id="cb67-9"><a href="multi-level-model.html#cb67-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-10"><a href="multi-level-model.html#cb67-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">&quot;Subject&quot;</span>, <span class="st">&quot;Register&quot;</span>, <span class="st">&quot;ArticulationS&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="multi-level-model.html#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="st">&quot;no pooling&quot;</span>)</span>
<span id="cb67-12"><a href="multi-level-model.html#cb67-12" aria-hidden="true" tabindex="-1"></a>pool_df <span class="ot">&lt;-</span> df[,<span class="fu">c</span>(<span class="st">&quot;Subject&quot;</span>, <span class="st">&quot;Register&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="multi-level-model.html#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-14"><a href="multi-level-model.html#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ArticulationS =</span> <span class="fu">ifelse</span>(Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span>, <span class="fu">mean</span>(df<span class="sc">$</span>ArticulationS[df<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span>]), <span class="fu">mean</span>(df<span class="sc">$</span>ArticulationS[df<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;IDS&quot;</span>])),</span>
<span id="cb67-15"><a href="multi-level-model.html#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Type =</span> <span class="st">&quot;total pooling&quot;</span></span>
<span id="cb67-16"><a href="multi-level-model.html#cb67-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-17"><a href="multi-level-model.html#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="multi-level-model.html#cb67-18" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_df,df) </span>
<span id="cb67-19"><a href="multi-level-model.html#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="multi-level-model.html#cb67-20" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_df,pool_df) </span>
<span id="cb67-21"><a href="multi-level-model.html#cb67-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-22"><a href="multi-level-model.html#cb67-22" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> plot_df <span class="sc">%&gt;%</span></span>
<span id="cb67-23"><a href="multi-level-model.html#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Register=</span><span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(Register)))</span>
<span id="cb67-24"><a href="multi-level-model.html#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="multi-level-model.html#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(Register, ArticulationS, <span class="at">color =</span> Type)) <span class="sc">+</span> </span>
<span id="cb67-26"><a href="multi-level-model.html#cb67-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb67-27"><a href="multi-level-model.html#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb67-28"><a href="multi-level-model.html#cb67-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Subject) <span class="sc">+</span></span>
<span id="cb67-29"><a href="multi-level-model.html#cb67-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb67-30"><a href="multi-level-model.html#cb67-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb67-31"><a href="multi-level-model.html#cb67-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb67-32"><a href="multi-level-model.html#cb67-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb67-33"><a href="multi-level-model.html#cb67-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb67-34"><a href="multi-level-model.html#cb67-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb67-35"><a href="multi-level-model.html#cb67-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>),</span>
<span id="cb67-36"><a href="multi-level-model.html#cb67-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>The following code shows how to plot partial pooling:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="multi-level-model.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Now the ellipsis plot</span></span>
<span id="cb68-2"><a href="multi-level-model.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial pooling</span></span>
<span id="cb68-3"><a href="multi-level-model.html#cb68-3" aria-hidden="true" tabindex="-1"></a>df_partial <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb68-4"><a href="multi-level-model.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Subject =</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;Intercept&quot;</span>]),</span>
<span id="cb68-5"><a href="multi-level-model.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ADS =</span> <span class="fu">coef</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;Intercept&quot;</span>][,<span class="dv">1</span>],</span>
<span id="cb68-6"><a href="multi-level-model.html#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">RegisterIDS =</span> <span class="fu">coef</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;RegisterIDS&quot;</span>][,<span class="dv">1</span>],</span>
<span id="cb68-7"><a href="multi-level-model.html#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="st">&quot;Partial pooling&quot;</span></span>
<span id="cb68-8"><a href="multi-level-model.html#cb68-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-9"><a href="multi-level-model.html#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Original data</span></span>
<span id="cb68-10"><a href="multi-level-model.html#cb68-10" aria-hidden="true" tabindex="-1"></a>df_no <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb68-11"><a href="multi-level-model.html#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>Subject)){</span>
<span id="cb68-12"><a href="multi-level-model.html#cb68-12" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb68-13"><a href="multi-level-model.html#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Subject =</span> s,</span>
<span id="cb68-14"><a href="multi-level-model.html#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADS =</span> d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span> <span class="sc">&amp;</span> d<span class="sc">$</span>Subject<span class="sc">==</span>s],</span>
<span id="cb68-15"><a href="multi-level-model.html#cb68-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegisterIDS =</span> d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;IDS&quot;</span> <span class="sc">&amp;</span> d<span class="sc">$</span>Subject<span class="sc">==</span>s] <span class="sc">-</span> d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span> <span class="sc">&amp;</span> d<span class="sc">$</span>Subject<span class="sc">==</span>s],</span>
<span id="cb68-16"><a href="multi-level-model.html#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Type =</span> <span class="st">&quot;No pooling&quot;</span></span>
<span id="cb68-17"><a href="multi-level-model.html#cb68-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-18"><a href="multi-level-model.html#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">&quot;df_no&quot;</span>)){df_no <span class="ot">=</span> <span class="fu">rbind</span>(df_no, tmp)} <span class="cf">else</span> {df_no <span class="ot">=</span> tmp}</span>
<span id="cb68-19"><a href="multi-level-model.html#cb68-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-20"><a href="multi-level-model.html#cb68-20" aria-hidden="true" tabindex="-1"></a>df_total <span class="ot">&lt;-</span> df_no[,<span class="fu">c</span>(<span class="st">&quot;Subject&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb68-21"><a href="multi-level-model.html#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-22"><a href="multi-level-model.html#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADS =</span> <span class="fu">mean</span>(d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span>]),</span>
<span id="cb68-23"><a href="multi-level-model.html#cb68-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegisterIDS =</span>  <span class="fu">mean</span>(d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;IDS&quot;</span>]) <span class="sc">-</span> <span class="fu">mean</span>(d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span>]),</span>
<span id="cb68-24"><a href="multi-level-model.html#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Type =</span> <span class="st">&quot;Total pooling&quot;</span></span>
<span id="cb68-25"><a href="multi-level-model.html#cb68-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-26"><a href="multi-level-model.html#cb68-26" aria-hidden="true" tabindex="-1"></a>df_fixef <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb68-27"><a href="multi-level-model.html#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="st">&quot;Partial pooling (average)&quot;</span>,</span>
<span id="cb68-28"><a href="multi-level-model.html#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">ADS =</span> <span class="fu">fixef</span>(Articulation_m3)[<span class="dv">1</span>],</span>
<span id="cb68-29"><a href="multi-level-model.html#cb68-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">RegisterIDS =</span> <span class="fu">fixef</span>(Articulation_m3)[<span class="dv">2</span>]</span>
<span id="cb68-30"><a href="multi-level-model.html#cb68-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-31"><a href="multi-level-model.html#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="multi-level-model.html#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete pooling / fixed effects are center of gravity in the plot</span></span>
<span id="cb68-33"><a href="multi-level-model.html#cb68-33" aria-hidden="true" tabindex="-1"></a>df_gravity <span class="ot">&lt;-</span> df_total <span class="sc">%&gt;%</span> </span>
<span id="cb68-34"><a href="multi-level-model.html#cb68-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Type, ADS, RegisterIDS) <span class="sc">%&gt;%</span> </span>
<span id="cb68-35"><a href="multi-level-model.html#cb68-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df_fixef)</span>
<span id="cb68-36"><a href="multi-level-model.html#cb68-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-37"><a href="multi-level-model.html#cb68-37" aria-hidden="true" tabindex="-1"></a>df_pulled <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_no, df_partial)</span>
<span id="cb68-38"><a href="multi-level-model.html#cb68-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-39"><a href="multi-level-model.html#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variance covariance matrix</span></span>
<span id="cb68-40"><a href="multi-level-model.html#cb68-40" aria-hidden="true" tabindex="-1"></a>cov_mat_t <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(Articulation_m3)[[<span class="st">&quot;Subject&quot;</span>]]<span class="sc">$</span>cov</span>
<span id="cb68-41"><a href="multi-level-model.html#cb68-41" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb68-42"><a href="multi-level-model.html#cb68-42" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;Intercept&quot;</span>][<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb68-43"><a href="multi-level-model.html#cb68-43" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">2</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;RegisterIDS&quot;</span>][<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb68-44"><a href="multi-level-model.html#cb68-44" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">1</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;Intercept&quot;</span>][<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb68-45"><a href="multi-level-model.html#cb68-45" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;RegisterIDS&quot;</span>][<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb68-46"><a href="multi-level-model.html#cb68-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-47"><a href="multi-level-model.html#cb68-47" aria-hidden="true" tabindex="-1"></a>make_ellipse <span class="ot">&lt;-</span> <span class="cf">function</span>(cov_mat, center, level) {</span>
<span id="cb68-48"><a href="multi-level-model.html#cb68-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ellipse</span>(cov_mat, <span class="at">centre =</span> center, <span class="at">level =</span> level) <span class="sc">%&gt;%</span></span>
<span id="cb68-49"><a href="multi-level-model.html#cb68-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-50"><a href="multi-level-model.html#cb68-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">level =</span> level) <span class="sc">%&gt;%</span> </span>
<span id="cb68-51"><a href="multi-level-model.html#cb68-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb68-52"><a href="multi-level-model.html#cb68-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-53"><a href="multi-level-model.html#cb68-53" aria-hidden="true" tabindex="-1"></a>center <span class="ot">&lt;-</span> <span class="fu">fixef</span>(Articulation_m3)</span>
<span id="cb68-54"><a href="multi-level-model.html#cb68-54" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">5</span>, .<span class="dv">7</span>, .<span class="dv">9</span>)</span>
<span id="cb68-55"><a href="multi-level-model.html#cb68-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-56"><a href="multi-level-model.html#cb68-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an ellipse dataframe for each of the levels defined </span></span>
<span id="cb68-57"><a href="multi-level-model.html#cb68-57" aria-hidden="true" tabindex="-1"></a><span class="co"># above and combine them</span></span>
<span id="cb68-58"><a href="multi-level-model.html#cb68-58" aria-hidden="true" tabindex="-1"></a>df_ellipse <span class="ot">&lt;-</span> levels <span class="sc">%&gt;%</span></span>
<span id="cb68-59"><a href="multi-level-model.html#cb68-59" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">make_ellipse</span>(cov_mat, center, <span class="at">level =</span> .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-60"><a href="multi-level-model.html#cb68-60" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">ADS =</span> x, <span class="at">RegisterIDS =</span> y)</span>
<span id="cb68-61"><a href="multi-level-model.html#cb68-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-62"><a href="multi-level-model.html#cb68-62" aria-hidden="true" tabindex="-1"></a>Gaussian_ellipsis <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_pulled) <span class="sc">+</span> </span>
<span id="cb68-63"><a href="multi-level-model.html#cb68-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> ADS, <span class="at">y =</span> RegisterIDS, <span class="at">color =</span> Type) <span class="sc">+</span> </span>
<span id="cb68-64"><a href="multi-level-model.html#cb68-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw contour lines from the distribution of effects</span></span>
<span id="cb68-65"><a href="multi-level-model.html#cb68-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb68-66"><a href="multi-level-model.html#cb68-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> level, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb68-67"><a href="multi-level-model.html#cb68-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_ellipse, </span>
<span id="cb68-68"><a href="multi-level-model.html#cb68-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb68-69"><a href="multi-level-model.html#cb68-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey40&quot;</span></span>
<span id="cb68-70"><a href="multi-level-model.html#cb68-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb68-71"><a href="multi-level-model.html#cb68-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_gravity, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb68-72"><a href="multi-level-model.html#cb68-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb68-73"><a href="multi-level-model.html#cb68-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb68-74"><a href="multi-level-model.html#cb68-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> Subject, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb68-75"><a href="multi-level-model.html#cb68-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">02</span>, <span class="st">&quot;npc&quot;</span>))</span>
<span id="cb68-76"><a href="multi-level-model.html#cb68-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb68-77"><a href="multi-level-model.html#cb68-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use ggrepel to jitter the labels away from the points</span></span>
<span id="cb68-78"><a href="multi-level-model.html#cb68-78" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb68-79"><a href="multi-level-model.html#cb68-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Subject, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb68-80"><a href="multi-level-model.html#cb68-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_no</span>
<span id="cb68-81"><a href="multi-level-model.html#cb68-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb68-82"><a href="multi-level-model.html#cb68-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don&#39;t forget 373</span></span>
<span id="cb68-83"><a href="multi-level-model.html#cb68-83" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb68-84"><a href="multi-level-model.html#cb68-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Subject, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb68-85"><a href="multi-level-model.html#cb68-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_partial</span>
<span id="cb68-86"><a href="multi-level-model.html#cb68-86" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb68-87"><a href="multi-level-model.html#cb68-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Topographic map of regression parameters&quot;</span>) <span class="sc">+</span> </span>
<span id="cb68-88"><a href="multi-level-model.html#cb68-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Intercept estimate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb68-89"><a href="multi-level-model.html#cb68-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Slope estimate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb68-90"><a href="multi-level-model.html#cb68-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-91"><a href="multi-level-model.html#cb68-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb68-92"><a href="multi-level-model.html#cb68-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb68-93"><a href="multi-level-model.html#cb68-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb68-94"><a href="multi-level-model.html#cb68-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb68-95"><a href="multi-level-model.html#cb68-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb68-96"><a href="multi-level-model.html#cb68-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb68-97"><a href="multi-level-model.html#cb68-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb68-98"><a href="multi-level-model.html#cb68-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>))</span>
<span id="cb68-99"><a href="multi-level-model.html#cb68-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-100"><a href="multi-level-model.html#cb68-100" aria-hidden="true" tabindex="-1"></a>Gaussian_ellipsis</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="student-t-model" class="section level3" number="4.2.7">
<h3><span class="header-section-number">4.2.7</span> Student t model</h3>
<p>One of the ways to allow for more flexibility in the distribution of the data would be to model the data using a student t likelihood. The main difference between the Gaussian and student t distribution is that a student t distribution with a low degrees of freedom parameter, nu, has heavier tails than the conventional Gaussian distribution. This form of model thus dampens the influence of outliers - incorporating outliers without allowing them to dominate non-outlier data. You can specify a student likelihood in the model using the ‘family’ parameter. As we can see in the results of the below get_prior() function, we now have to provide an additional prior for nu. For the following student t model, we will set the prior to be gamma(2, 0.1):</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="multi-level-model.html#cb69-1" aria-hidden="true" tabindex="-1"></a>Articulation_f3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(ArticulationS <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Register <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>Register<span class="sc">|</span>Subject))</span>
<span id="cb69-2"><a href="multi-level-model.html#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="multi-level-model.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(Articulation_f3, <span class="at">data =</span> d, <span class="at">family =</span> student)</span>
<span id="cb69-4"><a href="multi-level-model.html#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="multi-level-model.html#cb69-5" aria-hidden="true" tabindex="-1"></a>student_priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb69-6"><a href="multi-level-model.html#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb69-7"><a href="multi-level-model.html#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> Subject),</span>
<span id="cb69-8"><a href="multi-level-model.html#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b),</span>
<span id="cb69-9"><a href="multi-level-model.html#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> RegisterIDS, <span class="at">group =</span> Subject),</span>
<span id="cb69-10"><a href="multi-level-model.html#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">class =</span> sigma),</span>
<span id="cb69-11"><a href="multi-level-model.html#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor),</span>
<span id="cb69-12"><a href="multi-level-model.html#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">2</span>, <span class="fl">0.1</span>), <span class="at">class =</span> nu))</span>
<span id="cb69-13"><a href="multi-level-model.html#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="multi-level-model.html#cb69-14" aria-hidden="true" tabindex="-1"></a>Articulation_student_m3 <span class="ot">&lt;-</span> </span>
<span id="cb69-15"><a href="multi-level-model.html#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb69-16"><a href="multi-level-model.html#cb69-16" aria-hidden="true" tabindex="-1"></a>    Articulation_f3,</span>
<span id="cb69-17"><a href="multi-level-model.html#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb69-18"><a href="multi-level-model.html#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb69-19"><a href="multi-level-model.html#cb69-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> student,</span>
<span id="cb69-20"><a href="multi-level-model.html#cb69-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> student_priors,</span>
<span id="cb69-21"><a href="multi-level-model.html#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;Articulation_student_m3&quot;</span>,</span>
<span id="cb69-22"><a href="multi-level-model.html#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#refit = &quot;on_change&quot;,</span></span>
<span id="cb69-23"><a href="multi-level-model.html#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_prior =</span> T,</span>
<span id="cb69-24"><a href="multi-level-model.html#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">10000</span>, </span>
<span id="cb69-25"><a href="multi-level-model.html#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb69-26"><a href="multi-level-model.html#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb69-27"><a href="multi-level-model.html#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb69-28"><a href="multi-level-model.html#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">&quot;cmdstanr&quot;</span>,</span>
<span id="cb69-29"><a href="multi-level-model.html#cb69-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">2</span>),</span>
<span id="cb69-30"><a href="multi-level-model.html#cb69-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb69-31"><a href="multi-level-model.html#cb69-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.999</span>,</span>
<span id="cb69-32"><a href="multi-level-model.html#cb69-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>))</span>
<span id="cb69-33"><a href="multi-level-model.html#cb69-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-34"><a href="multi-level-model.html#cb69-34" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Articulation_student_m3)</span>
<span id="cb69-35"><a href="multi-level-model.html#cb69-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-36"><a href="multi-level-model.html#cb69-36" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(Articulation_student_m3), <span class="at">points =</span> T)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Let’s check the prior-posterior update plots for the student t model:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="multi-level-model.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sample the parameters of interest:</span></span>
<span id="cb70-2"><a href="multi-level-model.html#cb70-2" aria-hidden="true" tabindex="-1"></a>Posterior_student_m3 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(Articulation_student_m3)</span>
<span id="cb70-3"><a href="multi-level-model.html#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="multi-level-model.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for the intercept:</span></span>
<span id="cb70-5"><a href="multi-level-model.html#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_student_m3) <span class="sc">+</span></span>
<span id="cb70-6"><a href="multi-level-model.html#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_Intercept), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb70-7"><a href="multi-level-model.html#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(b_Intercept), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb70-8"><a href="multi-level-model.html#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Intercept&#39;</span>) <span class="sc">+</span></span>
<span id="cb70-9"><a href="multi-level-model.html#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="multi-level-model.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for b:</span></span>
<span id="cb71-2"><a href="multi-level-model.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_student_m3) <span class="sc">+</span></span>
<span id="cb71-3"><a href="multi-level-model.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_b), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb71-4"><a href="multi-level-model.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(b_RegisterIDS), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb71-5"><a href="multi-level-model.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;b&#39;</span>) <span class="sc">+</span></span>
<span id="cb71-6"><a href="multi-level-model.html#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="multi-level-model.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for sd of intercepts and slopes:</span></span>
<span id="cb72-2"><a href="multi-level-model.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_student_m3) <span class="sc">+</span></span>
<span id="cb72-3"><a href="multi-level-model.html#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(sd_Subject__Intercept), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb72-4"><a href="multi-level-model.html#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(sd_Subject__RegisterIDS), <span class="at">fill=</span><span class="st">&quot;#228B22&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb72-5"><a href="multi-level-model.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_sd_Subject__RegisterIDS), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb72-6"><a href="multi-level-model.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;sd&#39;</span>) <span class="sc">+</span></span>
<span id="cb72-7"><a href="multi-level-model.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-3.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="multi-level-model.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for sigma:</span></span>
<span id="cb73-2"><a href="multi-level-model.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_student_m3) <span class="sc">+</span></span>
<span id="cb73-3"><a href="multi-level-model.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_sigma), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="multi-level-model.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(sigma), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb73-5"><a href="multi-level-model.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;sigma&#39;</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="multi-level-model.html#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-4.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="multi-level-model.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for the correlation between varying intercepts and slopes:</span></span>
<span id="cb74-2"><a href="multi-level-model.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_student_m3) <span class="sc">+</span></span>
<span id="cb74-3"><a href="multi-level-model.html#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_cor_Subject), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a href="multi-level-model.html#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(cor_Subject__Intercept__RegisterIDS), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb74-5"><a href="multi-level-model.html#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;cor&#39;</span>) <span class="sc">+</span></span>
<span id="cb74-6"><a href="multi-level-model.html#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-5.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="multi-level-model.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the prior-posterior update plot for the correlation between varying intercepts and slopes:</span></span>
<span id="cb75-2"><a href="multi-level-model.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Posterior_student_m3) <span class="sc">+</span></span>
<span id="cb75-3"><a href="multi-level-model.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(prior_nu), <span class="at">fill=</span><span class="st">&quot;steelblue&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="multi-level-model.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(nu), <span class="at">fill=</span><span class="st">&quot;#FC4E07&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb75-5"><a href="multi-level-model.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;nu&#39;</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="multi-level-model.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-6.png" width="672" /></p>
<p>How do the estimates and evidence ratio of the student model compare to that of the Gaussian model?</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="multi-level-model.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#hypothesis check for Gaussian model:</span></span>
<span id="cb76-2"><a href="multi-level-model.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(Articulation_m3, <span class="st">&quot;RegisterIDS &lt; 0&quot;</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class b:
##          Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob
## 1 (RegisterIDS) &lt; 0    -0.39      0.21    -0.72    -0.05      27.99      0.97
##   Star
## 1    *
## ---
## &#39;CI&#39;: 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 95%;
## for two-sided hypotheses, the value tested against lies outside the 95%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="multi-level-model.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#hypothesis check for student t model:</span></span>
<span id="cb78-2"><a href="multi-level-model.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(Articulation_student_m3, <span class="st">&quot;RegisterIDS &lt; 0&quot;</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class b:
##          Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob
## 1 (RegisterIDS) &lt; 0    -0.39       0.2    -0.72    -0.05      31.79      0.97
##   Star
## 1    *
## ---
## &#39;CI&#39;: 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 95%;
## for two-sided hypotheses, the value tested against lies outside the 95%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<p>Here is some code to plot the posterior student model estimates for each individual subject:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="multi-level-model.html#cb80-1" aria-hidden="true" tabindex="-1"></a>ADS_data <span class="ot">&lt;-</span> <span class="fu">spread_rvars</span>(Articulation_student_m3, r_Subject[r_Subject, Intercept], b_Intercept, b_RegisterIDS) <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="multi-level-model.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject_estimate =</span> r_Subject <span class="sc">+</span> b_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="multi-level-model.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;ADS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="multi-level-model.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;RegisterIDS&quot;</span>, <span class="st">&quot;IDS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-5"><a href="multi-level-model.html#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Intercept <span class="sc">==</span> <span class="st">&quot;ADS&quot;</span>)</span>
<span id="cb80-6"><a href="multi-level-model.html#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="multi-level-model.html#cb80-7" aria-hidden="true" tabindex="-1"></a>IDS_data <span class="ot">&lt;-</span> <span class="fu">spread_rvars</span>(Articulation_student_m3, r_Subject[r_Subject, Intercept], b_Intercept, b_RegisterIDS) <span class="sc">%&gt;%</span></span>
<span id="cb80-8"><a href="multi-level-model.html#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject_estimate =</span> r_Subject <span class="sc">+</span> b_RegisterIDS) <span class="sc">%&gt;%</span></span>
<span id="cb80-9"><a href="multi-level-model.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;ADS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-10"><a href="multi-level-model.html#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;RegisterIDS&quot;</span>, <span class="st">&quot;IDS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-11"><a href="multi-level-model.html#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Intercept <span class="sc">==</span> <span class="st">&quot;IDS&quot;</span>)</span>
<span id="cb80-12"><a href="multi-level-model.html#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="multi-level-model.html#cb80-13" aria-hidden="true" tabindex="-1"></a>posterior_data_plot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(ADS_data, IDS_data) <span class="sc">%&gt;%</span></span>
<span id="cb80-14"><a href="multi-level-model.html#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(Subject_estimate) <span class="sc">%&gt;%</span></span>
<span id="cb80-15"><a href="multi-level-model.html#cb80-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(d<span class="sc">$</span>Subject), <span class="dv">2</span>))</span>
<span id="cb80-16"><a href="multi-level-model.html#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="multi-level-model.html#cb80-17" aria-hidden="true" tabindex="-1"></a>student_model_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb80-18"><a href="multi-level-model.html#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Subject_estimate), <span class="at">data =</span> posterior_data_plot, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, ) <span class="sc">+</span></span>
<span id="cb80-19"><a href="multi-level-model.html#cb80-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Subject_estimate, <span class="at">color =</span> Subject), <span class="at">data =</span> posterior_data_plot, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb80-20"><a href="multi-level-model.html#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Subject_estimate, <span class="at">color =</span> Subject, <span class="at">group =</span> Subject), <span class="at">data =</span> posterior_data_plot, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-21"><a href="multi-level-model.html#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb80-22"><a href="multi-level-model.html#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.75</span>, <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb80-23"><a href="multi-level-model.html#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Speech Style&#39;</span>) <span class="sc">+</span> </span>
<span id="cb80-24"><a href="multi-level-model.html#cb80-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect Size&#39;</span>) <span class="sc">+</span></span>
<span id="cb80-25"><a href="multi-level-model.html#cb80-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Student Model&#39;</span>) <span class="sc">+</span></span>
<span id="cb80-26"><a href="multi-level-model.html#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">27</span>)) <span class="sc">+</span> </span>
<span id="cb80-27"><a href="multi-level-model.html#cb80-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">15</span>), </span>
<span id="cb80-28"><a href="multi-level-model.html#cb80-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb80-29"><a href="multi-level-model.html#cb80-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb80-30"><a href="multi-level-model.html#cb80-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb80-31"><a href="multi-level-model.html#cb80-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb80-32"><a href="multi-level-model.html#cb80-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span></code></pre></div>
<p>Let’s compare these estimates with the multi-level Gaussian model:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="multi-level-model.html#cb81-1" aria-hidden="true" tabindex="-1"></a>ADS_data <span class="ot">&lt;-</span> <span class="fu">spread_rvars</span>(Articulation_m3, r_Subject[r_Subject, Intercept], b_Intercept, b_RegisterIDS) <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="multi-level-model.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject_estimate =</span> r_Subject <span class="sc">+</span> b_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="multi-level-model.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;ADS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="multi-level-model.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;RegisterIDS&quot;</span>, <span class="st">&quot;IDS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="multi-level-model.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Intercept <span class="sc">==</span> <span class="st">&quot;ADS&quot;</span>)</span>
<span id="cb81-6"><a href="multi-level-model.html#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="multi-level-model.html#cb81-7" aria-hidden="true" tabindex="-1"></a>IDS_data <span class="ot">&lt;-</span> <span class="fu">spread_rvars</span>(Articulation_m3, r_Subject[r_Subject, Intercept], b_Intercept, b_RegisterIDS) <span class="sc">%&gt;%</span></span>
<span id="cb81-8"><a href="multi-level-model.html#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject_estimate =</span> r_Subject <span class="sc">+</span> b_RegisterIDS) <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="multi-level-model.html#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;ADS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-10"><a href="multi-level-model.html#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="fu">replace</span>(Intercept, Intercept <span class="sc">==</span> <span class="st">&quot;RegisterIDS&quot;</span>, <span class="st">&quot;IDS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-11"><a href="multi-level-model.html#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Intercept <span class="sc">==</span> <span class="st">&quot;IDS&quot;</span>)</span>
<span id="cb81-12"><a href="multi-level-model.html#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="multi-level-model.html#cb81-13" aria-hidden="true" tabindex="-1"></a>posterior_data_plot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(ADS_data, IDS_data) <span class="sc">%&gt;%</span></span>
<span id="cb81-14"><a href="multi-level-model.html#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(Subject_estimate) <span class="sc">%&gt;%</span></span>
<span id="cb81-15"><a href="multi-level-model.html#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Subject =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(d<span class="sc">$</span>Subject), <span class="dv">2</span>))</span>
<span id="cb81-16"><a href="multi-level-model.html#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="multi-level-model.html#cb81-17" aria-hidden="true" tabindex="-1"></a>gaussian_model_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-18"><a href="multi-level-model.html#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Subject_estimate), <span class="at">data =</span> posterior_data_plot, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, ) <span class="sc">+</span></span>
<span id="cb81-19"><a href="multi-level-model.html#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Subject_estimate, <span class="at">color =</span> Subject), <span class="at">data =</span> posterior_data_plot, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb81-20"><a href="multi-level-model.html#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Subject_estimate, <span class="at">color =</span> Subject, <span class="at">group =</span> Subject), <span class="at">data =</span> posterior_data_plot, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb81-21"><a href="multi-level-model.html#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-22"><a href="multi-level-model.html#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.75</span>, <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb81-23"><a href="multi-level-model.html#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Speech Style&#39;</span>) <span class="sc">+</span> </span>
<span id="cb81-24"><a href="multi-level-model.html#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Effect Size&#39;</span>) <span class="sc">+</span></span>
<span id="cb81-25"><a href="multi-level-model.html#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Gaussian Model&#39;</span>) <span class="sc">+</span></span>
<span id="cb81-26"><a href="multi-level-model.html#cb81-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">27</span>)) <span class="sc">+</span> </span>
<span id="cb81-27"><a href="multi-level-model.html#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">15</span>), </span>
<span id="cb81-28"><a href="multi-level-model.html#cb81-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb81-29"><a href="multi-level-model.html#cb81-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb81-30"><a href="multi-level-model.html#cb81-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb81-31"><a href="multi-level-model.html#cb81-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb81-32"><a href="multi-level-model.html#cb81-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span>
<span id="cb81-33"><a href="multi-level-model.html#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="multi-level-model.html#cb81-34" aria-hidden="true" tabindex="-1"></a>comparison_plot <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(gaussian_model_plot, student_model_plot, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb81-35"><a href="multi-level-model.html#cb81-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-36"><a href="multi-level-model.html#cb81-36" aria-hidden="true" tabindex="-1"></a>comparison_plot</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Q7: How do the individual trajectories differ between the two models? Why do you think we see these differences?</p>
<hr />
<p>Let’s also make an ellipsis plot for the student model:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="multi-level-model.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Now the ellipsis plot</span></span>
<span id="cb82-2"><a href="multi-level-model.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Partial pooling</span></span>
<span id="cb82-3"><a href="multi-level-model.html#cb82-3" aria-hidden="true" tabindex="-1"></a>df_partial <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-4"><a href="multi-level-model.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Subject =</span> <span class="fu">rownames</span>(<span class="fu">coef</span>(Articulation_student_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;Intercept&quot;</span>]),</span>
<span id="cb82-5"><a href="multi-level-model.html#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ADS =</span> <span class="fu">coef</span>(Articulation_student_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;Intercept&quot;</span>][,<span class="dv">1</span>],</span>
<span id="cb82-6"><a href="multi-level-model.html#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">RegisterIDS =</span> <span class="fu">coef</span>(Articulation_student_m3)[[<span class="st">&quot;Subject&quot;</span>]][,,<span class="st">&quot;RegisterIDS&quot;</span>][,<span class="dv">1</span>],</span>
<span id="cb82-7"><a href="multi-level-model.html#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="st">&quot;Partial pooling&quot;</span></span>
<span id="cb82-8"><a href="multi-level-model.html#cb82-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-9"><a href="multi-level-model.html#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Original data</span></span>
<span id="cb82-10"><a href="multi-level-model.html#cb82-10" aria-hidden="true" tabindex="-1"></a>df_no <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb82-11"><a href="multi-level-model.html#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="multi-level-model.html#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>Subject)){</span>
<span id="cb82-13"><a href="multi-level-model.html#cb82-13" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-14"><a href="multi-level-model.html#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Subject =</span> s,</span>
<span id="cb82-15"><a href="multi-level-model.html#cb82-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADS =</span> d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span> <span class="sc">&amp;</span> d<span class="sc">$</span>Subject<span class="sc">==</span>s],</span>
<span id="cb82-16"><a href="multi-level-model.html#cb82-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegisterIDS =</span> d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;IDS&quot;</span> <span class="sc">&amp;</span> d<span class="sc">$</span>Subject<span class="sc">==</span>s] <span class="sc">-</span> d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span> <span class="sc">&amp;</span> d<span class="sc">$</span>Subject<span class="sc">==</span>s],</span>
<span id="cb82-17"><a href="multi-level-model.html#cb82-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Type =</span> <span class="st">&quot;No pooling&quot;</span></span>
<span id="cb82-18"><a href="multi-level-model.html#cb82-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-19"><a href="multi-level-model.html#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">&quot;df_no&quot;</span>)){df_no <span class="ot">=</span> <span class="fu">rbind</span>(df_no, tmp)} <span class="cf">else</span> {df_no <span class="ot">=</span> tmp}</span>
<span id="cb82-20"><a href="multi-level-model.html#cb82-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-21"><a href="multi-level-model.html#cb82-21" aria-hidden="true" tabindex="-1"></a>df_total <span class="ot">&lt;-</span> df_no[,<span class="fu">c</span>(<span class="st">&quot;Subject&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb82-22"><a href="multi-level-model.html#cb82-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-23"><a href="multi-level-model.html#cb82-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADS =</span> <span class="fu">mean</span>(d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span>]),</span>
<span id="cb82-24"><a href="multi-level-model.html#cb82-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegisterIDS =</span>  <span class="fu">mean</span>(d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;IDS&quot;</span>]) <span class="sc">-</span> <span class="fu">mean</span>(d<span class="sc">$</span>ArticulationS[d<span class="sc">$</span>Register<span class="sc">==</span><span class="st">&quot;ADS&quot;</span>]),</span>
<span id="cb82-25"><a href="multi-level-model.html#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Type =</span> <span class="st">&quot;Total pooling&quot;</span></span>
<span id="cb82-26"><a href="multi-level-model.html#cb82-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-27"><a href="multi-level-model.html#cb82-27" aria-hidden="true" tabindex="-1"></a>df_fixef <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-28"><a href="multi-level-model.html#cb82-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="st">&quot;Partial pooling (average)&quot;</span>,</span>
<span id="cb82-29"><a href="multi-level-model.html#cb82-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">ADS =</span> <span class="fu">fixef</span>(Articulation_student_m3)[<span class="dv">1</span>],</span>
<span id="cb82-30"><a href="multi-level-model.html#cb82-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">RegisterIDS =</span> <span class="fu">fixef</span>(Articulation_student_m3)[<span class="dv">2</span>]</span>
<span id="cb82-31"><a href="multi-level-model.html#cb82-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-32"><a href="multi-level-model.html#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="multi-level-model.html#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete pooling / fixed effects are center of gravity in the plot</span></span>
<span id="cb82-34"><a href="multi-level-model.html#cb82-34" aria-hidden="true" tabindex="-1"></a>df_gravity <span class="ot">&lt;-</span> df_total <span class="sc">%&gt;%</span> </span>
<span id="cb82-35"><a href="multi-level-model.html#cb82-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Type, ADS, RegisterIDS) <span class="sc">%&gt;%</span> </span>
<span id="cb82-36"><a href="multi-level-model.html#cb82-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df_fixef)</span>
<span id="cb82-37"><a href="multi-level-model.html#cb82-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-38"><a href="multi-level-model.html#cb82-38" aria-hidden="true" tabindex="-1"></a>df_pulled <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_no, df_partial)</span>
<span id="cb82-39"><a href="multi-level-model.html#cb82-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-40"><a href="multi-level-model.html#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the variance covariance matrix</span></span>
<span id="cb82-41"><a href="multi-level-model.html#cb82-41" aria-hidden="true" tabindex="-1"></a>cov_mat_t <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(Articulation_student_m3)[[<span class="st">&quot;Subject&quot;</span>]]<span class="sc">$</span>cov</span>
<span id="cb82-42"><a href="multi-level-model.html#cb82-42" aria-hidden="true" tabindex="-1"></a>cov_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb82-43"><a href="multi-level-model.html#cb82-43" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;Intercept&quot;</span>][<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb82-44"><a href="multi-level-model.html#cb82-44" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">2</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;RegisterIDS&quot;</span>][<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb82-45"><a href="multi-level-model.html#cb82-45" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">1</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;Intercept&quot;</span>][<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb82-46"><a href="multi-level-model.html#cb82-46" aria-hidden="true" tabindex="-1"></a>cov_mat[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span>cov_mat_t[,,<span class="st">&quot;RegisterIDS&quot;</span>][<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb82-47"><a href="multi-level-model.html#cb82-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-48"><a href="multi-level-model.html#cb82-48" aria-hidden="true" tabindex="-1"></a>make_ellipse <span class="ot">&lt;-</span> <span class="cf">function</span>(cov_mat, center, level) {</span>
<span id="cb82-49"><a href="multi-level-model.html#cb82-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ellipse</span>(cov_mat, <span class="at">centre =</span> center, <span class="at">level =</span> level) <span class="sc">%&gt;%</span></span>
<span id="cb82-50"><a href="multi-level-model.html#cb82-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-51"><a href="multi-level-model.html#cb82-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">level =</span> level) <span class="sc">%&gt;%</span> </span>
<span id="cb82-52"><a href="multi-level-model.html#cb82-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb82-53"><a href="multi-level-model.html#cb82-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-54"><a href="multi-level-model.html#cb82-54" aria-hidden="true" tabindex="-1"></a>center <span class="ot">&lt;-</span> <span class="fu">fixef</span>(Articulation_student_m3)</span>
<span id="cb82-55"><a href="multi-level-model.html#cb82-55" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">5</span>, .<span class="dv">7</span>, .<span class="dv">9</span>)</span>
<span id="cb82-56"><a href="multi-level-model.html#cb82-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-57"><a href="multi-level-model.html#cb82-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an ellipse dataframe for each of the levels defined </span></span>
<span id="cb82-58"><a href="multi-level-model.html#cb82-58" aria-hidden="true" tabindex="-1"></a><span class="co"># above and combine them</span></span>
<span id="cb82-59"><a href="multi-level-model.html#cb82-59" aria-hidden="true" tabindex="-1"></a>df_ellipse <span class="ot">&lt;-</span> levels <span class="sc">%&gt;%</span></span>
<span id="cb82-60"><a href="multi-level-model.html#cb82-60" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">make_ellipse</span>(cov_mat, center, <span class="at">level =</span> .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-61"><a href="multi-level-model.html#cb82-61" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">ADS =</span> x, <span class="at">RegisterIDS =</span> y)</span>
<span id="cb82-62"><a href="multi-level-model.html#cb82-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-63"><a href="multi-level-model.html#cb82-63" aria-hidden="true" tabindex="-1"></a>Student_ellipsis <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_pulled) <span class="sc">+</span> </span>
<span id="cb82-64"><a href="multi-level-model.html#cb82-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> ADS, <span class="at">y =</span> RegisterIDS, <span class="at">color =</span> Type) <span class="sc">+</span> </span>
<span id="cb82-65"><a href="multi-level-model.html#cb82-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw contour lines from the distribution of effects</span></span>
<span id="cb82-66"><a href="multi-level-model.html#cb82-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb82-67"><a href="multi-level-model.html#cb82-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> level, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb82-68"><a href="multi-level-model.html#cb82-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_ellipse, </span>
<span id="cb82-69"><a href="multi-level-model.html#cb82-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb82-70"><a href="multi-level-model.html#cb82-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey40&quot;</span></span>
<span id="cb82-71"><a href="multi-level-model.html#cb82-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb82-72"><a href="multi-level-model.html#cb82-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_gravity, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb82-73"><a href="multi-level-model.html#cb82-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb82-74"><a href="multi-level-model.html#cb82-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb82-75"><a href="multi-level-model.html#cb82-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> Subject, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb82-76"><a href="multi-level-model.html#cb82-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">02</span>, <span class="st">&quot;npc&quot;</span>))</span>
<span id="cb82-77"><a href="multi-level-model.html#cb82-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb82-78"><a href="multi-level-model.html#cb82-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use ggrepel to jitter the labels away from the points</span></span>
<span id="cb82-79"><a href="multi-level-model.html#cb82-79" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb82-80"><a href="multi-level-model.html#cb82-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Subject, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb82-81"><a href="multi-level-model.html#cb82-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_no</span>
<span id="cb82-82"><a href="multi-level-model.html#cb82-82" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb82-83"><a href="multi-level-model.html#cb82-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don&#39;t forget 373</span></span>
<span id="cb82-84"><a href="multi-level-model.html#cb82-84" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb82-85"><a href="multi-level-model.html#cb82-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> Subject, <span class="at">color =</span> <span class="cn">NULL</span>), </span>
<span id="cb82-86"><a href="multi-level-model.html#cb82-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_partial</span>
<span id="cb82-87"><a href="multi-level-model.html#cb82-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb82-88"><a href="multi-level-model.html#cb82-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Topographic map of regression parameters&quot;</span>) <span class="sc">+</span> </span>
<span id="cb82-89"><a href="multi-level-model.html#cb82-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Intercept estimate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb82-90"><a href="multi-level-model.html#cb82-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Slope estimate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb82-91"><a href="multi-level-model.html#cb82-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-92"><a href="multi-level-model.html#cb82-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb82-93"><a href="multi-level-model.html#cb82-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb82-94"><a href="multi-level-model.html#cb82-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb82-95"><a href="multi-level-model.html#cb82-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb82-96"><a href="multi-level-model.html#cb82-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb82-97"><a href="multi-level-model.html#cb82-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb82-98"><a href="multi-level-model.html#cb82-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb82-99"><a href="multi-level-model.html#cb82-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">&quot;white&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">size=</span><span class="fl">1.5</span>, <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>))</span>
<span id="cb82-100"><a href="multi-level-model.html#cb82-100" aria-hidden="true" tabindex="-1"></a>Student_ellipsis</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simple-linear-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="informed-priors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-part2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
